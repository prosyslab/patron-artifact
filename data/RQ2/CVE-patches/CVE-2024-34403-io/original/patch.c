#include <stdio.h>
#include <stdint.h>

#define URI_ERROR_MALLOC -1
#define URI_ERROR_NULL -2
#define URI_SUCCESS 0

struct UriMemoryManager {
  int dummy;
  int dummy2;
  int dummy3;
};

typedef struct UriMemoryManager UriMemoryManager;

struct QueryList {
  int dummy;
  int dummy2;
  int dummy3;
};

typedef struct QueryList QueryList;

void init_source(char **dest, QueryList **queryList)
{
  FILE *fp;
  fp = fopen("test.txt", "w+");
  if (fp == NULL) {
    return;
  }
  fscanf(fp, "%s", dest);
  *queryList = malloc(sizeof(QueryList));
  (*queryList)->dummy = 1;
  (*queryList)->dummy2 = 2;
  (*queryList)->dummy3 = 3;
}

int ComposeQueryCharsRequiredEx(int * charsRequired, int spaceToPlus, int normalizeBreaks) {
  FILE *fp;
  fp = fopen("test.txt", "w+");
  if (fp == NULL) {
    return URI_ERROR_NULL;
  }
  fscanf(fp, "%d", charsRequired);
  return URI_SUCCESS;
}

int ComposeQueryMallocExMm(char ** dest, QueryList * queryList, int spaceToPlus, int normalizeBreaks, UriMemoryManager * memory) {
	int charsRequired;
	int res;
	if (dest == NULL) {
		return URI_ERROR_NULL;
	}

	/* Calculate space */
	res = ComposeQueryCharsRequiredEx(&charsRequired, spaceToPlus, normalizeBreaks);
	if (res != URI_SUCCESS) {
		return res;
	}
	if (charsRequired == INT_MAX) {
	    return URI_ERROR_MALLOC;
	}
	charsRequired++;

	/* Allocate space */
	// memory = malloc(charsRequired * sizeof(char*));
	memory = calloc(charsRequired, sizeof(char*));

	return URI_SUCCESS;
}

int main(int argc, char **argv) {
  int spaceToPlus = 8;
  int normalizeBreaks = 8;
  char *dest;
  UriMemoryManager *memory;
  QueryList *queryList;
  init_source(&dest, &queryList);
  ComposeQueryMallocExMm(&dest, queryList, spaceToPlus, normalizeBreaks, memory);
  return 0;
}