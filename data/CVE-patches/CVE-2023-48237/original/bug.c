#include <stdio.h>
#include <stdint.h>

char *curbuf;
int pos;
/*
 * Idem, using the first non-black in the current line.
 */
    long
get_sw_value_indent(char *buf)
{
    return buf[pos];
}

int get_indent() {
  return curbuf[0];
}

void init_indent(int *left, int *round, int *amount, int *call_changed_bytes) {
  FILE *f = fopen("file.txt", "r");
  fscanf(f, "%d %d %d %d", left, round, amount, call_changed_bytes);
  curbuf = malloc(1000);
  fscanf(f, "%s", curbuf);
  fscanf(f, "%d", &pos);
}

/*
 * Shift the current line one shiftwidth left (if left != 0) or right
 * leaves cursor on first blank in the line.
 */
    void
shift_line(
    int	left,
    int	round,
    int	amount,
    int call_changed_bytes)	// call changed_bytes()
{
    int		count;
    // long long	count;
    int		i, j;
    int		sw_val = (int)get_sw_value_indent(curbuf);

    count = get_indent();	// get current indent
    // count = (long long)get_indent();	// get current indent

    if (round)			// round off indent
    {
	i = count / sw_val;	// number of 'shiftwidth' rounded down
	j = count % sw_val;	// extra spaces
	if (j && left)		// first remove extra spaces
	    --amount;
	if (left)
	{
	    i -= amount;
	    if (i < 0)
		i = 0;
	}
	else
	    i += amount;
	count = i * sw_val;
    }
    else		// original vi indent
    {
	if (left)
	{
	    count -= sw_val * amount;
	    if (count < 0)
		count = 0;
	}
	else
	    count += sw_val * amount;
	// {
	//     if ((long long)sw_val * (long long)amount > INT_MAX - count)
	// 	count = INT_MAX;
	//     else
	// 	count += (long long)sw_val * (long long)amount;
	// }
    }

}

int main(int argc, char **argv) {
  int left, round, amount, call_changed_bytes;
  init_indent(&left, &round, &amount, &call_changed_bytes);
  shift_line(left, round, amount, call_changed_bytes);
  return 0;
}