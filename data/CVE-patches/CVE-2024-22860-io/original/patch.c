#include <stdio.h>
#include <stdint.h>

#define AVSEEK_SIZE 0x10000
#define SEEK_SET 0
#define SEEK_END 2
#define INT_MAX 2147483647

uintptr_t filesize;

void read_filesize() {
    FILE *fp;
    fp = fopen("file.bin", "rb");
    if (fp == NULL) {
        printf("Error opening file\n");
        return;
    }
    fscanf(fp, "%lx", &filesize);
    fclose(fp);
}

int allocate_packet(uintptr_t size) {
    void *buf = malloc(size);
    if (!buf) {
        return -1;
    }
    free(buf);
    return 0;
}

int jpegxl_anim_read_packet(uintptr_t size) {
    if (size > INT_MAX) {
        printf("Error: Size exceeds maximum limit\n");
        return -1;
    }
    return allocate_packet((int)size); // Potential overflow here
}

int main(int argc, char **argv) {
    read_filesize();

    if (filesize == 0) {
        filesize = 4096;
    }
    
    jpegxl_anim_read_packet(filesize);

    return 0;
}
